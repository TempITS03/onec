&НаКлиенте
Перем мОсновнаяВалютаВзаиморасчетов;

&НаСервере
Функция НайтиДвиженияПоВзаиморасчетам(Валюта)
	
	Если Объект.Ссылка.Пустая() Тогда
		Возврат Ложь;
	КонецЕсли;	
	
	Запрос = Новый Запрос("ВЫБРАТЬ ПЕРВЫЕ 1
	|	ВзаиморасчетыСКонтрагентами.Контрагент
	|ИЗ
	|	РегистрНакопления.ВзаиморасчетыСКонтрагентами КАК ВзаиморасчетыСКонтрагентами
	|ГДЕ
	|	ВзаиморасчетыСКонтрагентами.Организация = &Организация
	|	И ВзаиморасчетыСКонтрагентами.Валюта = &Валюта");
	
	Запрос.УстановитьПараметр("Организация",Объект.Ссылка);
	Запрос.УстановитьПараметр("Валюта",Валюта);
	
	РезультатВыборки = Запрос.Выполнить();
	
	Возврат НЕ РезультатВыборки.Пустой()
	
КонецФункции	

&НаКлиенте
//Процедура определяет можно ли изменить валюту
//
Процедура ОпределитьВозможностьИзмененияВалютыВзаиморасчетовОрганизации(СтандартнаяОбработка=Истина)
	
	Если НайтиДвиженияПоВзаиморасчетам(мОсновнаяВалютаВзаиморасчетов) Тогда
		СтандартнаяОбработка = Ложь;
		Предупреждение("Установленная текущая валюта используется у взаиморасчетах."+Символы.ПС+"Необходимо сначала изменить взаиморасчеты!");
		Объект.ОсновнаяВалютаВзаиморасчетов = мОсновнаяВалютаВзаиморасчетов;
	КонецЕсли;	
	
КонецПроцедуры	

&НаКлиенте
Процедура ОсновнаяВалютаВзаиморасчетовПриИзменении(Элемент)
	
	ОпределитьВозможностьИзмененияВалютыВзаиморасчетовОрганизации();
	
КонецПроцедуры

&НаКлиенте
Процедура ОсновнаяВалютаВзаиморасчетовОчистка(Элемент, СтандартнаяОбработка)
	
	ОпределитьВозможностьИзмененияВалютыВзаиморасчетовОрганизации(СтандартнаяОбработка);
	
КонецПроцедуры

&НаКлиенте
Процедура ОсновнаяВалютаВзаиморасчетовНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	мОсновнаяВалютаВзаиморасчетов = Объект.ОсновнаяВалютаВзаиморасчетов;
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	мОсновнаяВалютаВзаиморасчетов = Объект.ОсновнаяВалютаВзаиморасчетов;
	
КонецПроцедуры
