
&НаКлиенте
Процедура ОбменЗагрузкаДанных(Команда)
	
	Если ПодключитьРасширениеРаботыСФайлами() Тогда
		
		КаталогОбмена = ОбменДаннымиСервер.ОсновнойКаталогОбменаДанными();
		МассивПроверкиНаличияКаталога = НайтиФайлы(КаталогОбмена);
		
		Если ПустаяСтрока(КаталогОбмена) или МассивПроверкиНаличияКаталога.Количество() = 0 Тогда
			
			Режим = РежимДиалогаВыбораФайла.ВыборКаталога;
			ДиалогВыбораКаталога = Новый ДиалогВыбораФайла(Режим);
			ДиалогВыбораКаталога.Заголовок = "Выберите каталог где будут хранится файлв обменов";
			
			Если ДиалогВыбораКаталога.Выбрать() Тогда
				КаталогОбмена = ДиалогВыбораКаталога.Каталог;
			Иначе
				Предупреждение("Необходимо указать каталог обмена. Это можно указать и в константе!");
				Возврат;
			КонецЕсли;
			
		КонецЕсли;	
		
		ЗагрузкаДанных(КаталогОбмена);
		Оповестить("ЗагрузкаДокументовРегламентноеЗадание");
		
	Иначе
		
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = "Возникла ошибка подключения расширенной работы с файлами!";
		Сообщение.Сообщить();
		
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ЗагрузкаДанных(КаталогОбмена)
	
	//ПараметрКоманды - содержит массив документов выгрузки
	ВыборкаУзлов = ПланыОбмена.ОбменЗадачами.Выбрать();
	
	Пока ВыборкаУзлов.Следующий() Цикл
		
		Если ВыборкаУзлов.Ссылка = ПланыОбмена.ОбменЗадачами.ЭтотУзел() Тогда
			Продолжить;
		КонецЕсли;	
		
		УзелОбъект = ВыборкаУзлов.ПолучитьОбъект();
		
		//Получить сообщение
		УзелОбъект.ПрочитатьСообщениеСИзменениями(КаталогОбмена);
		
	КонецЦикла;	

КонецПроцедуры

&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	
	Если (ИмяСобытия = "ЗагрузкаДокументовРегламентноеЗадание") или (ИмяСобытия = "ВыгрузкаДокументовРегламентноеЗадание") Тогда
		Элементы.Список.Обновить();
	КонецЕсли;
	
КонецПроцедуры

