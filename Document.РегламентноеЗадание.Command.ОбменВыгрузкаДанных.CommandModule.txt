 

&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	
	Если НЕ ОбщегоНазначения.ОпределитьПроведениеДокументаПередПечатью(ПараметрКоманды) Тогда
		Возврат;
	КонецЕсли;	
	
	Если ПодключитьРасширениеРаботыСФайлами() Тогда
		
		КаталогВыгрузки = ОбменДаннымиСервер.ОсновнойКаталогОбменаДанными();
		МассивПроверкиНаличияКаталога = НайтиФайлы(КаталогВыгрузки);
		
		Если ПустаяСтрока(КаталогВыгрузки) или МассивПроверкиНаличияКаталога.Количество() = 0 Тогда
			
			Режим = РежимДиалогаВыбораФайла.ВыборКаталога;
			ДиалогВыбораКаталога = Новый ДиалогВыбораФайла(Режим);
			ДиалогВыбораКаталога.Заголовок = "Выберите каталог где будут хранится файлв обменов";
			
			Если ДиалогВыбораКаталога.Выбрать() Тогда
				КаталогВыгрузки = ДиалогВыбораКаталога.Каталог;
			Иначе
				Предупреждение("Необходимо указать каталог обмена. Это можно указать и в константе!");
				Возврат;
			КонецЕсли;
			
		КонецЕсли;
	Иначе
		
		Предупреждение(НСтр("ru = 'Данная возможность недоступна, так как не подключено расширение работы с файлами.'", "ru"));	
		Возврат;
	КонецЕсли;
	
	ВыгрузкаДанных(ПараметрКоманды,КаталогВыгрузки);

	Оповестить("ВыгрузкаДокументовРегламентноеЗадание");
	
КонецПроцедуры

&НаСервере
Процедура ВыгрузкаДанных(ПараметрКоманды,КаталогОбмена)
	
	//ПараметрКоманды - содержит массив документов выгрузки
	ВыборкаУзлов = ПланыОбмена.ОбменЗадачами.Выбрать();
	
	Пока ВыборкаУзлов.Следующий() Цикл
		
		Если ВыборкаУзлов.Ссылка = ПланыОбмена.ОбменЗадачами.ЭтотУзел() Тогда
			Продолжить;
		КонецЕсли;	
		
		УзелОбъект = ВыборкаУзлов.ПолучитьОбъект();
		
		//Сформировать сообщение
		УзелОбъект.ЗаписатьСообщениеСИзменениями(ПараметрКоманды,КаталогОбмена);
		
	КонецЦикла;	

КонецПроцедуры
